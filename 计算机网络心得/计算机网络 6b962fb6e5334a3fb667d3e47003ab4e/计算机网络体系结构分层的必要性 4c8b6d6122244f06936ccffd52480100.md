# 计算机网络体系结构分层的必要性

分层思想是我们熟悉的，将一个很大的事情分解成很多小的事情逐个解决，也是分治思想，那么这篇笔记就讲述一下5层模型每一层干的事情，以及它们的意义。

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled.png)

## 物理层

当计算机和计算机之前传输信息时，我们需要确定采用什么传输媒体（比如网线），或者采用什么无理接口，使用怎么样的信号表示0和1，将电信号转换为电压和电流传输到计算机上，这就是物理层做的事情。

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%201.png)

## 数据链路层

实用的计算机网络，是有多个主机组成构成的，并且在物理层已经解决了如何传输信息的功能，比如在一个总线网络中，我需要A给C传输信息，信号会通过总线传播到每一个主机上，以太网是一个常见的数据链路层协议，使用网卡的mac地址标识网络上的设备，mac地址是唯一的，并且发送的数据包会携带上mac地址，确保发送目标无误，并且会在传输过程中进行错误检测和校验，这就是数据链路层的意义

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%202.png)

## 网络层

解决了数据链路层和物理层，就可以在一个网络中进行传输数据了，但是因特网是由多个网络组成的

那么如何标识网络和网络中的主机呢，就可以使用ip进行操作

IP地址包含4个十进制的内容，前三个来标识网络，后一个表示设备

而源主机和目标主机如何转发分组，或者如何进行路由选择，这就是网络层的主要工作

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%203.png)

## 运输层

这个层次使用协议来确保数据传输的可靠性，将数据分层比较小的数据包，在传输中进行错误检测和重传

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%204.png)

## 应用层

没有应用层就无法满足日常需要，应用层负责应用程序之间的数据传输和通信，包括各种应用程序，比如浏览器，电子邮件，文件传输等等

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%205.png)

## 总结

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%206.png)

## 举例

我们使用浏览器对服务器进行请求，返回数据时，这是最常见的场景，我们可以用这个例子讲解分层：

首先，浏览器和服务器通信是使用HTTP协议，也就是应用层，发送的是HTTP报文，解析的也是HTTP报文。

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%207.png)

然后HTTP将报文交付给运输层TCP进行传输，运输层会将其添加一个TCP首部，转换成TCP报文段，该首部是为了区分应用进程，和实现可靠传输。

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%208.png)

之后会将这个TCP报文传递给网络层，这一层会被添加一个IP首部，让其可以在互联网上传输

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%209.png)

之后在数据链路层会被添加首和尾，让其成为一个帧，这个首帧目的是为了可以在一个网络上可以传输，尾帧可以检查是否有误码。

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%2010.png)

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%2011.png)

之后到物理层，物理层将帧看作一个比特流，在以太网上，还需要给流加上一个前导码，目的是为了让目标主机准备接受帧。之后将这个比特流转换成信号发送到路由器中。

在通过传输媒体给到路由器之后，路由器需要在物理层去掉前导码之后依次向上转换，即去掉首尾帧，最终给网络层交付的是IP数据报，IP数据包中提取首部之后确定目标主机，通过自身的路由表去查找；然后再依次向下去添加首部，直到最后发送给服务器。

到服务器中，还是依次向上去解析，最终在应用层拿到了HTTP报文，然后再返回结果，过程类似。

由此我们可以看到，在一个传输过程中，每一层都各司其职，添加一些首部和信息来确定下一步任务，这就是分层思想的案例。

## 专业术语

从3个层面区分术语：

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%2012.png)

### 实体

指的是任何可发送或接收信息的硬件或软件进程，那么每一个块都可以看作为一个实体

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%2013.png)

### 对等实体

收发双方相同层次中的实体，比如下图可以看作为对等实体：

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%2014.png)

### 协议

控制2个对等实体进行逻辑通信的规则的集合，每一层的协议都不一样

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%2015.png)

### 协议三要素

指的是语法，语义，同步。

语法指的是定义交换信息的格式，比如请求和响应的格式，需要遵从一些规定，比如这是IP数据报的格式：

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%2016.png)

而语义定义了收发双方说要完成的操作，比如一个HTTP get请求从客户端发送到服务端，服务端需要将结果包装成报文给客户端，客户端再解析报文渲染成网页。

同步指的是，收发双方的时序关系，比如TCP的三次握手之后才可以进行通信，握手的过程就是一个时序关系，如图：

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%2017.png)

### 服务

在协议的控制下，两个对等实体之间的通信使得本层能够向上一次提供服务，这就像程序中的封装思想一样，我的上层调用只需要调用底层暴露出来的接口，开发者不需要了解底层是如何实现的，那么五层协议模型也有这样的思想。

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%2018.png)

可以发现，协议是水平通信的，服务是垂直的，实体看得见下层的服务，但是不知道实现该服务的具体协议，也就是说下面的协议对上面的实体是透明的。

### 服务访问点

在同一个系统中相邻两层的实体交换信息的逻辑接口，用于区分不同的服务类型，也就是垂直上的点，那么不同的服务就有不同的服务访问点，数据链路层是帧的类型字段，网络层这是IP数据报首部中的协议字段，运输层则是端口号。

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%2019.png)

### 服务原语

上层使用下层所提供的服务必须通过与下层交换一些命令，这些命令叫服务原语

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%2020.png)

### PDU（协议数据单元）

对等层次之间传送的数据包称为该层的协议数据单元，每一层的PDU表达都不一样

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%2021.png)

### SDU（服务数据单元）

同一个系统内，层和层之间的转换的数据包就叫服务数据单元

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%2022.png)

## 术语总结

![Untitled](%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%204c8b6d6122244f06936ccffd52480100/Untitled%2023.png)

[1.7 第1章 概述 章节小结_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1c4411d7jb?p=11&vd_source=b6439e98284c7d50ca88dc9948ecf9b0)