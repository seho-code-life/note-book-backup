# 开发第四节：城市页面的开发和用到的插件

# 开发第四节：城市页面的开发和用到的插件

城市页面并没有参照视频上的老版的网站做，所以这篇说明也会有关于老版的组件中的一些坑

首先我们安装几个依赖插件，axios插件和betterscrool插件

安装之后我们来布局一下页面

首先我们获取到官方提供的城市页面详细json文件，把它放在static文件夹下

然后我们在city父组件中引入axios来通过ajax获取文件中的数据

![https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002124411.png](https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002124411.png)

首先我们在data中定义一个对象和一个数组来存热门城市，和城市列表的数据

![https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002124459.png](https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002124459.png)

我们在vue中写一个生命周期的函数用来被挂载实例之后执行getcityInfo方法，这个方法我们通过ajax中get方法获取我们本地存放的json文件，它的返回函数我们定义了一个方法，

handelbacksuccess这个方法，有一个参数指的是返回获取到的参数。

在我们这个获取到的参数中，有一个为data，data中存放的是热门城市和城市列表的内容，所以我们把这两个内容附给变量res，在这个变量中有选项状态和内容，我们判断相应状态为true，和内容不为空来把数据附给我们定义好的对象和数组。

附了之后，我们通过父组件向子组件传值的方式来让子组件进行展示这些数据。

![https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002125222.png](https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002125222.png)

把对象和数组传递过去给子组件。

子组件接受：

![https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002125255.png](https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002125255.png)

并且规定这两个数据为对象和数组。然后我们进行排版内容

![https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002125723.png](https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002125723.png)

使用ullli标签排版，值得注意的是，官方网站上没有设置右边框，我们通过border-right来设置他的右边框，不会影响布局，在这里通过循环就可以全部展示出来。

重写右边框的样式

![https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002125852.png](https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002125852.png)

然后循环我们的城市列表页面

![https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002130157.png](https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002130157.png)

值得注意的是，城市列表的页面的key值不是数组，而是 A B C D这样的键名，所以这边我们循环2次，第一次循环的是一个大类，比如A类，B类，里面又循环一次的内容是A中的内容，等于简单来说，第一次循环把很多数据拆分成ABCD这样的大块，里面的循环则循环里面的内容，并且展示出来。

其次，第一次循环的 key值是ABCD这样的字符串，所以我们通过ref引用的形式，来让每个块的dom对象对应上它的key值ABCD。

然后循环我们的字母表

![https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002130728.png](https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002130728.png)

在每个字母表中添加点击事件

当点击某个字母的时候就跳到某个城市区域。

这边要用都一个插件betterscroll插件中的方法，跳到一个dom区域

![https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002132846.png](https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002132846.png)

ps：这边的方法名称写错了，应该是

scrollToElement

点击事件传递的是事件对象，事件对象中的target.innerText能获取到元素 ABCD字符串

通过refs[“指定的内容：例如ABCD等”]返回的是数组，第0项是dom对象，然后dom对象传给方法中参数，就可以实现点击字母表的数据跳转到具体的区域了。

思路解释：

首先我们在城市列表页面中，指定了refs的内容为它们的下标id，是ABCD这样的字符串，然后通过字母表的点击时间，来获取具体是ABCD这样的字符串，匹配对应的dom，从而获取到dom节点。

另外要说的是，我不同于官方的网站一样，对移动端进行了更好的体验，用到了betterscorll，让页面划起来更流畅还有动画效果。

首先要观察betterscroll插件使用的dom规范

<div class="wrapper">

<ul class="content">

<li>...</li>

<li>...</li>

...

</ul>

<!-- you can put some other DOMs here, it won't affect the scrolling</div>

![https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002140235.png](https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002140235.png)

在页面被挂载时，传入对象的dom对象，就可以把页面更流畅以及动画效果，值得注意的是，在做测试的时候，需要把父级dom设置成绝对定位，否则无效。

![https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002140508.png](https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181002140508.png)

---

下来我们开发的是搜索页面，我们要实现的功能是搜索

我们来简要分析一下

![https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181004113508.png](https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181004113508.png)

我们首先做一个搜索框，然后通过双向数据绑定来和数据绑定在一起。

然后我们要做一个div，中有ul和li

简单布局一下，然后让这个div绝对定位，而且层级要最高覆盖本来页面，然后要能通过betterscorll可以上下滑动。

![https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181004113840.png](https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181004113840.png)

当被挂载的时候，可以滚动

然后我们开始来做逻辑，首先我们要想清楚一件事情，如果要展示这些数据，需要一个结果数组，我们首先定义一个空数组来存放

然后呢，我们再写方法。

我们这边通过监听器，来监听搜索框中的输入变化，如果有变化，我们执行下面的操作。

![https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181004114255.png](https://www.notion.so开发第四节：城市页面的开发和用到的插件_files/QQ截图20181004114255.png)

在上面的代码里，我们为了达到节流的手段，data中定义了一个timer为null，通过这样的方式可以很好的解决

计时器中我们定义数组，通过双层的循环，把热门城市和城市列表的分开，然后循环中通过与名称做对比，如果对比成功，这个对比不是对比字符串，而是查找，如果有相匹配的数据就把它push到list中，e参数是循环的值变量

然后就实现了搜索，值得注意是如果我们如果没有搜索，输入框为空，那么结果集就给他设置为空，展示不了数据，然后终止此方法

然后我们在这是上面的优化一下，首先得有一个没有找到此数据，我们在定义一个li标签，然后条件展示show，结果集的长度为空即可